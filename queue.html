<!DOCTYPE html>
<html>
<head>
<title>‚ú® Smart Queue Tracker</title>

<style>

/* ===== BACKGROUND ===== */

body{
margin:0;
font-family:'Segoe UI',Arial;
background:linear-gradient(135deg,#89f7fe,#66a6ff);
padding:30px;
overflow-x:hidden;
}

/* Floating Glass Shapes */

.bgShape{
position:fixed;
border-radius:50%;
background:rgba(255,255,255,0.2);
backdrop-filter:blur(10px);
animation:float 10s infinite ease-in-out;
z-index:-1;
}

.s1{width:180px;height:180px;top:10%;left:5%;}
.s2{width:120px;height:120px;bottom:15%;right:8%;animation-delay:2s;}
.s3{width:90px;height:90px;top:50%;right:20%;animation-delay:4s;}

@keyframes float{
0%{transform:translateY(0);}
50%{transform:translateY(-25px);}
100%{transform:translateY(0);}
}

/* ===== TITLE ===== */

h2{
text-align:center;
font-size:28px;
background:linear-gradient(45deg,#2e7d32,#2196f3);
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
animation:glow 2s infinite alternate;
}

@keyframes glow{
from{opacity:.7;}
to{opacity:1;}
}

/* ===== ROLLING BANNER ===== */

.rollingBanner{
background:linear-gradient(90deg,#4caf50,#2196f3);
color:white;
padding:10px;
overflow:hidden;
border-radius:15px;
margin-bottom:20px;
}

.marquee{
display:inline-block;
white-space:nowrap;
animation:scroll 12s linear infinite;
font-weight:bold;
}

@keyframes scroll{
0%{transform:translateX(100%);}
100%{transform:translateX(-100%);}
}

/* ===== MAIN CARD ===== */

.card{
background:white;
padding:25px;
border-radius:20px;
margin:auto;
width:480px;
box-shadow:0 10px 30px rgba(0,0,0,.2);
transition:.3s;
}

.card:hover{
transform:translateY(-5px);
}

.glow{
box-shadow:0 0 25px #4caf50;
}

.big{
font-size:32px;
font-weight:bold;
color:#2e7d32;
}

/* ===== PROGRESS BAR ===== */

.progressContainer{
background:#e0e0e0;
height:12px;
border-radius:20px;
margin-top:10px;
overflow:hidden;
}

.progressBar{
height:100%;
background:linear-gradient(90deg,#4caf50,#81c784);
width:0%;
transition:width 1s ease;
}

/* ===== TOKENS BEFORE ===== */

.section{
margin-top:20px;
}

.tokenCard{
padding:12px;
margin:8px 0;
border-radius:12px;
font-size:15px;
background:#e3f2fd;
animation:slideIn .4s ease;
transition:.3s;
}

.tokenCard.waiting{
background:#fff3cd;
}

.tokenCard.current{
background:#c8e6c9;
border-left:6px solid #2e7d32;
font-weight:bold;
}

@keyframes slideIn{
from{opacity:0;transform:translateX(-20px);}
to{opacity:1;transform:translateX(0);}
}

/* ===== TOAST ===== */

.toast{
position:fixed;
bottom:30px;
right:30px;
background:#323232;
color:white;
padding:15px 20px;
border-radius:12px;
opacity:0;
transform:translateY(20px);
transition:.4s;
box-shadow:0 5px 20px rgba(0,0,0,.3);
}

.toast.show{
opacity:1;
transform:translateY(0);
}

</style>
</head>

<body>

<!-- Floating Shapes -->
<div class="bgShape s1"></div>
<div class="bgShape s2"></div>
<div class="bgShape s3"></div>

<h2>üîî Live Queue Status</h2>

<div class="rollingBanner">
<div class="marquee">
üè• Now Serving Patients ‚Äî Please Stay Alert üîî
</div>
</div>

<div class="card" id="mainCard">

<div id="myStatus"></div>

<div class="progressContainer">
<div class="progressBar" id="progressBar"></div>
</div>

<div class="section">
<h3>Tokens Before You</h3>
<div id="beforeList"></div>
</div>

</div>

<div class="toast" id="toast"></div>

<script>

const API = "http://localhost:3000";
const token = Number(localStorage.getItem("patientToken"));

let announced = false;
let lastPosition = null;

/* ===== TOAST ===== */

function showToast(msg){
toast.innerText = msg;
toast.classList.add("show");
setTimeout(()=>toast.classList.remove("show"),3000);
}

/* ===== VOICE ===== */

function announceTurn(tokenNumber){

speechSynthesis.cancel();

const msg = new SpeechSynthesisUtterance(
`Attention please. Token ${tokenNumber}, please proceed to the doctor.`
);

msg.rate = 1;
msg.pitch = 1;

speechSynthesis.speak(msg);
}

/* ===== BEEP ===== */

function beep(){
const ctx = new AudioContext();
const osc = ctx.createOscillator();
osc.frequency.setValueAtTime(900, ctx.currentTime);
osc.connect(ctx.destination);
osc.start();
setTimeout(()=>osc.stop(),300);
}

/* ===== LOAD QUEUE ===== */

async function loadQueue(){

if(!token){
beforeList.innerHTML="No token found";
return;
}

const queue = await fetch(API+"/queue")
.then(r=>r.json());

const my = await fetch(
API+"/patient/"+token
).then(r=>r.json());

const myIndex = queue.findIndex(
p=>p.token===token
);

/* ===== TURN ANNOUNCEMENT LOGIC ===== */

if(my.position === 1 && lastPosition !== 1){

showToast("üö® It's your turn now!");
beep();
announceTurn(my.token);
mainCard.classList.add("glow");

announced = true;
}

if(my.position !== 1){
announced = false;
mainCard.classList.remove("glow");
speechSynthesis.cancel();
}

lastPosition = my.position;

/* ===== UPDATE UI ===== */

myStatus.innerHTML=`

üéü Token: <span class="big">${my.token}</span><br>
üìç Position: ${my.position}<br>
‚è± Estimated Wait: ${my.estimated_wait_minutes} mins<br>
üë®‚Äç‚öïÔ∏è Doctor Status: ${my.doctorStatus}

`;

/* ===== PROGRESS BAR ===== */

let total = queue.length;
let progress = total===0 ? 0 :
((total - my.position + 1)/total)*100;

progressBar.style.width = progress + "%";

/* ===== TOKENS BEFORE ===== */

const before =
myIndex>0 ? queue.slice(0,myIndex) : [];

beforeList.innerHTML=

before.length===0

? `<div class="tokenCard current">
‚úÖ You are next!
</div>`

: before.map((p,i)=>`

<div class="tokenCard waiting">
üéü Token ${p.token}<br>
üìç Queue Position: ${i+1}
</div>

`).join("");

}

setInterval(loadQueue,2000);
loadQueue();

</script>


</body>
</html>
