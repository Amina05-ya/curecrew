<!DOCTYPE html>
<html>
<head>
<title>Hospital Appointment</title>

<style>
body{
font-family:Arial;
background:#eef4fb;
padding:20px;
}

h2{
text-align:center;
}

.card{
background:white;
padding:20px;
border-radius:12px;
margin:10px auto;
width:420px;
box-shadow:0 4px 12px rgba(0,0,0,.1);
}

select,button{
width:100%;
padding:10px;
margin:8px 0;
font-size:15px;
}

.result{
background:#e8f5e9;
padding:15px;
border-radius:8px;
margin-top:12px;
text-align:center;
}

.result h1{
margin:5px 0;
color:#2e7d32;
}

.queueBtn{
background:#2196F3;
color:white;
border:none;
border-radius:6px;
cursor:pointer;
}
</style>
</head>

<body>

<h2>üè• Smart Appointment Booking</h2>

<div class="card">

<label>City</label>
<select id="city" onchange="loadHospitals()"></select>

<label>Hospital</label>
<select id="hospital" onchange="loadDoctors()"></select>

<label>Doctor</label>
<select id="doctor"></select>

<button onclick="book()">Book Appointment</button>

<div id="result"></div>

</div>

<script>

const API="http://localhost:3000";

// ---------- INIT ----------

async function init(){
 const cities=await fetch(API+"/cities").then(r=>r.json());
 city.innerHTML=cities.map(c=>`<option>${c}</option>`).join("");
 loadHospitals();
}

// ---------- LOAD HOSPITALS ----------

async function loadHospitals(){
 const c=city.value;
 const data=await fetch(API+"/hospitals/"+c).then(r=>r.json());
 hospital.innerHTML=data.map(h=>`<option>${h}</option>`).join("");
 loadDoctors();
}

// ---------- LOAD DOCTORS ----------

async function loadDoctors(){
 const c=city.value;
 const h=hospital.value;
 const data=await fetch(API+"/doctors/"+c+"/"+h).then(r=>r.json());
 doctor.innerHTML=data.map(d=>`<option>${d}</option>`).join("");
}

// ---------- BOOK APPOINTMENT ----------

async function book(){

 const payload={
  city:city.value,
  hospital:hospital.value,
  doctor:doctor.value
 };

 const res=await fetch(API+"/book-appointment",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify(payload)
 });

 const data=await res.json();

 // store token for queue tracking
 localStorage.setItem("patientToken", data.token);

 // fallback wait = 0 if backend doesn't send it
const wait = data.estimated_wait_minutes || 0;

const arrival = new Date(
  Date.now() + wait * 60000
);

const arrivalTime = arrival.toLocaleTimeString([], {
  hour: '2-digit',
  minute: '2-digit'
});





result.innerHTML=`
<div class="result">

‚úÖ Appointment Confirmed<br><br>

üéü Token Number:<br>
<h1>${data.token}</h1>

üè• Please arrive at:<br>
<h3>${arrivalTime}</h3>

<br>

<button class="queueBtn"
onclick="goQueue()">
üîî Track Queue
</button>

</div>
`;

}

// ---------- GO TO QUEUE ----------

function goQueue(){
 window.location="queue.html";
}

// start
init();

</script>

</body>
</html>
