<!DOCTYPE html>
<html>
<head>
  <title>Smart Hospital Live Queue</title>

  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: #f5f7fb;
    }

    h2 { margin-top: 30px; }

    input, button {
      padding: 8px;
      margin: 5px;
    }

    button {
      cursor: pointer;
      background: #2d89ef;
      color: white;
      border: none;
      border-radius: 4px;
    }

    .card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-top: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
  </style>
</head>

<body>

<h1>ğŸ¥ Smart Hospital Live System</h1>

<!-- ================= PATIENT ================= -->

<h2>ğŸ§  Patient Intake</h2>

<input id="pname" placeholder="Patient Name">
<input id="symptom" placeholder="Symptoms">

<button onclick="addPatient()">Add Patient</button>

<div class="card" id="queue"></div>

<!-- ================= MEDICINES ================= -->

<h2>ğŸ’Š Medicines</h2>

<input id="mname" placeholder="Medicine Name">
<input id="mdose" placeholder="Dosage">

<button onclick="addMedicine()">Add Medicine</button>

<div class="card" id="meds"></div>

<!-- ================= DASHBOARD ================= -->

<h2>ğŸ“Š Doctor Dashboard</h2>

<div class="card" id="dashboard"></div>

<!-- ================= DOCTOR CONTROL ================= -->

<h2>ğŸ‘¨â€âš• Doctor Control</h2>

<button onclick="setDoctor('AVAILABLE', 0)">ğŸŸ¢ Available</button>
<button onclick="setDoctor('EMERGENCY', 15)">ğŸš¨ Emergency</button>
<button onclick="setDoctor('REFRESHMENT', 5)">â˜• Refreshment</button>

<!-- ================= REMINDERS ================= -->

<h2>ğŸ”” Live Reminders</h2>

<div class="card" id="reminders"></div>

<script>

const API = "http://localhost:3000";

// ================= PATIENT =================

async function addPatient() {

  const name = document.getElementById("pname").value;
  const text = document.getElementById("symptom").value;

  await fetch(API + "/smart-join", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ name, text })
  });

}

// ================= QUEUE =================

async function loadQueue() {

  const res = await fetch(API + "/queue");
  const data = await res.json();

  const html =
    data.length === 0
      ? "No patients"
      : data.map(p =>
          `Token ${p.token} â€” ${p.name} (severity ${p.severity})`
        ).join("<br>");

  const el = document.getElementById("queue");

  if (el.innerHTML !== html)
    el.innerHTML = "<b>Queue:</b><br>" + html;
}

// ================= MEDICINES =================

async function addMedicine() {

  const name = document.getElementById("mname").value;
  const dosage = document.getElementById("mdose").value;

  await fetch(API + "/medicine", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ name, dosage })
  });

}

async function loadMedicines() {

  const res = await fetch(API + "/medicines");
  const data = await res.json();

  const html =
    data.length === 0
      ? "No medicines"
      : data.map(m =>
          `${m.name} (${m.dosage}) â€” ${m.status}`
        ).join("<br>");

  const el = document.getElementById("meds");

  if (el.innerHTML !== html)
    el.innerHTML = "<b>Medicines:</b><br>" + html;
}

// ================= DASHBOARD =================

async function loadDashboard() {

  const res = await fetch(API + "/dashboard");
  const d = await res.json();

  const html =
    `
    Patients: ${d.totalPatients}<br>
    Emergencies: ${d.emergencyCount}<br>
    Doctor Status: ${d.doctorStatus}<br>
    Delay: ${d.delayMinutes} min<br>
    Medicine Adherence: ${d.medicineAdherencePercent}%
    `;

  const el = document.getElementById("dashboard");

  if (el.innerHTML !== html)
    el.innerHTML = html;
}

// ================= DOCTOR CONTROL =================

async function setDoctor(status, delay) {

  await fetch(API + "/doctor/status", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ status, delay })
  });

}

// ================= REMINDERS =================

async function loadReminders() {

  const res = await fetch(API + "/reminders");
  const data = await res.json();

  const html =
    data.length === 0
      ? "No reminders"
      : data.map(r =>
          `Token ${r.token}: ${r.message}`
        ).join("<br><br>");

  const el = document.getElementById("reminders");

  if (el.innerHTML !== html)
    el.innerHTML = html;
}

// ================= LIVE UPDATE STRATEGY =================

// slower refresh â†’ heavy data
setInterval(() => {
  loadQueue();
  loadDashboard();
  loadMedicines();
}, 4000);

// fast refresh â†’ reminders
setInterval(loadReminders, 1000);

// initial load
loadQueue();
loadDashboard();
loadMedicines();
loadReminders();

</script>

</body>
</html>

