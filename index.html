<!DOCTYPE html>
<html>
<head>
<title>ğŸ¥ Smart Hospital System</title>

<style>
body {
  font-family: Arial;
  background: #eef3f9;
  padding: 20px;
}

h2 {
  margin-top: 25px;
}

.card {
  background: white;
  padding: 12px;
  margin: 8px 0;
  border-radius: 8px;
  box-shadow: 0 0 5px rgba(0,0,0,0.1);
}

input, button {
  padding: 8px;
  margin: 4px;
}

button {
  cursor: pointer;
}
</style>
</head>

<body>

<h1>ğŸ¥ Smart Hospital Live System</h1>

<!-- ================= PATIENT ================= -->

<h2>ğŸ§  Patient Intake</h2>

<input id="pname" placeholder="Patient name">
<input id="symptom" placeholder="Symptoms">

<button onclick="addPatient()">Join Queue</button>

<div class="card" id="queueBox"></div>

<!-- ================= DOCTOR CONTROL ================= -->

<h2>ğŸ‘¨â€âš• Doctor Control</h2>

<button onclick="setDoctor('AVAILABLE',0)"
style="background:#4CAF50;color:white">
ğŸŸ¢ Available
</button>

<button onclick="setDoctor('EMERGENCY',15)"
style="background:#e53935;color:white">
ğŸš¨ Emergency (+15 min)
</button>

<button onclick="setDoctor('REFRESHMENT',30)"
style="background:#ff9800;color:white">
â˜• Break (+30 min)
</button>

<h2>ğŸ“¢ Call Next Patient</h2>

<button onclick="callNext()"
style="background:#2196F3;color:white">
â¡ Call Next
</button>



<!-- ================= QUEUE REMINDERS ================= -->

<h2>ğŸ”” Queue Reminders</h2>

<div class="card" id="reminderBox"></div>

<!-- ================= PATIENT NOTIFICATIONS ================= -->

<h2>ğŸ“¢ Patient Notification Screen</h2>

<div class="card" id="notifyBox"></div>

<!-- ================= MEDICINES ================= -->

<h2>ğŸ’Š Medicine Manager</h2>

<input id="mname" placeholder="Medicine">
<input id="mdose" placeholder="Dosage">
<input id="minterval" placeholder="Interval (minutes)">

<button onclick="addMedicine()">Add Medicine</button>

<div class="card" id="medBox"></div>

<h2>ğŸ’Š Medicine Alerts</h2>

<div class="card" id="medReminderBox"></div>

<!-- ================= DASHBOARD ================= -->

<h2>ğŸ“Š Dashboard</h2>

<div class="card" id="dashBox"></div>

<script>

const API = "http://localhost:3000";

// ================= ACTIONS =================

async function addPatient() {

  await fetch(API + "/smart-join", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({
      name: pname.value,
      text: symptom.value
    })
  });

  pname.value="";
  symptom.value="";
}

async function setDoctor(status,delay) {

  await fetch(API + "/doctor/status", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({status,delay})
  });

}

async function addMedicine() {

  await fetch(API + "/medicine", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({
      name: mname.value,
      dosage: mdose.value,
      interval: minterval.value
    })
  });

  mname.value="";
  mdose.value="";
  minterval.value="";
}

// ================= LOADERS =================

async function loadQueue() {

  const data = await fetch(API+"/queue").then(r=>r.json());

  queueBox.innerHTML =
    data.length===0
    ? "No patients"
    : data.map(p =>
      `Token ${p.token} â€” ${p.name} (severity ${p.severity})`
    ).join("<br>");
}

async function loadReminders() {

  const data = await fetch(API+"/reminders").then(r=>r.json());

  reminderBox.innerHTML =
    data.length===0
    ? "No reminders"
    : data.map(r =>
      `Token ${r.token}: ${r.message}`
    ).join("<br><br>");
}

async function loadNotifications() {

  const data = await fetch(API+"/notifications").then(r=>r.json());

  notifyBox.innerHTML =
    data.length===0
    ? "No notifications"
    : data.map(n =>
      `Token ${n.token}: ${n.message}`
    ).join("<br><br>");
}

async function loadMedicines() {

  const data = await fetch(API+"/medicines").then(r=>r.json());

  medBox.innerHTML =
    data.length===0
    ? "No medicines"
    : data.map(m =>
      `${m.name} (${m.dosage}) â€” ${m.status}`
    ).join("<br>");
}

async function loadMedicineAlerts() {

  const data = await fetch(API+"/medicine-reminders").then(r=>r.json());

  medReminderBox.innerHTML =
    data.length===0
    ? "No medicine alerts"
    : data.map(m =>
      m.message
    ).join("<br>");
}

async function loadDashboard() {

  const d = await fetch(API+"/dashboard").then(r=>r.json());

  dashBox.innerHTML = `
    Patients: ${d.totalPatients}<br>
    Emergencies: ${d.emergencyCount}<br>
    Doctor Status: ${d.doctorStatus}<br>
    Delay: ${d.delayMinutes} min<br>
    Medicine Adherence: ${d.medicineAdherencePercent}%
  `;
}

// ================= LIVE REFRESH =================

function refreshAll() {

  loadQueue();
  loadReminders();
  loadNotifications();
  loadMedicines();
  loadMedicineAlerts();
  loadDashboard();
}

setInterval(refreshAll, 2000);
refreshAll();

async function callNext() {

  const res = await fetch(API + "/call-next", {
    method:"POST"
  });

  const data = await res.json();

  alert(
    data.called
      ? `Calling Token ${data.called.token}`
      : data.message
  );

}


</script>

</body>
</html>
